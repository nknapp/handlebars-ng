---
/*
 * This component is used then links to hb-spec.json files are inserted into mdx
 *
 *   [](./example.hb-json.spec)
 *
 * This happen in the remark plugin in "astro-plugins/inject-testcase" in this repository
 */
import type { HandlebarsTest } from "@handlebars-ng/specification/tests";
import prettier from "prettier";

import { Code } from 'astro/components';

interface Props {
  spec: HandlebarsTest;
  filename: string;
}

const { spec, filename } = Astro.props;

const prettyAst = prettier.format(JSON.stringify(spec.ast), { parser: "json" });
const prettyInput = prettier.format(JSON.stringify(spec.input), {
  parser: "json",
});
---

<div class="testcase border-amber-900 border-2">
  <header class="bg-slate-200 p-2">
    <div class="text-lg">{filename}</div>
    <div>{spec.description}</div>
  </header>
  <main class="p-2">
    <dl>
      <dt>Template:</dt>
      <dd class="invisible-chars" title={JSON.stringify(spec.template)}>
        <Code code={spec.template} lang="handlebars" />
      </dd>
      <dt>Input</dt>
      <dd><Code code={prettyInput} lang={"json"}/></dd>
      <dt>Output</dt>
      <dd class="invisible-chars" title={JSON.stringify(spec.output)}>
        <Code code={spec.output} />
      </dd>
      <dt>AST</dt>
      <dd><Code code={prettyAst} lang={"json"}/></dd>
      {spec.originalAst && 
      <>
      <dt class="text-red-800">Warning: The original Handlebars implementation has a deviating AST (which the author of this document considers to be wrong):</dt>
        <dd><Code code={prettier.format(JSON.stringify(spec.originalAst), { parser: "json" })} lang={"json"}/></dd>
      </>}
    </dl>
  </main>
</div>
<style>
  dt {
    @apply font-bold;
  }
  code,
  pre {
    @apply bg-white;
    font-family: monospace;
  }
</style>
